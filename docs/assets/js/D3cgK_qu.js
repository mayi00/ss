import{a as e,b as a,c as t,d as l,e as n,f as s,g as o}from"./VVeD7ZTy.js";import{u as i,w as u,r}from"./DSA9T5jJ.js";import{D as c,l as d,o as m,G as f,A as p,n as g,E as h,R as v,a8 as b,P as _,u as y,c as x,r as B,F as w,$ as k,S,b as j}from"./CdiPUevL.js";import"./CVUiRIzB.js";import"./CT_jBSb5.js";import"./C_c7swkt.js";import"./S2LN4sv6.js";import"./D2oWfImC.js";const C=(e,a)=>{const t=e.__vccOpts||e;for(const[l,n]of a)t[l]=n;return t},N={key:0,class:"file-list"},E={style:{"max-width":"300px","max-height":"200px","overflow-y":"auto"}},M={class:"file-name g-single-ellipsis"},O={class:"dialog-footer"},$=C(Object.assign({name:"FileUpload"},{__name:"FileUpload",props:{dialogVisible:{type:Boolean,default:!1},width:{type:[String,Number],default:"500"},title:{type:String,default:"上传文件"},modal:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},multiple:{type:Boolean,default:!0},drag:{type:Boolean,default:!0},limit:{type:[Number,String],default:1},accept:{type:[String,Array],default:".xls,.xlsx"},loading:{type:Boolean,default:!1},maxSize:{type:[Number,String],default:5120}},emits:["on-confirm","on-cancel"],setup(o,{emit:i}){const u=o,r=i,C=B(!1),$=x(()=>u.limit>1&&u.multiple),z=x(()=>Number(u.limit)),F=x(()=>u.drag?"将文件拖到此处或点击上传":"点击上传"),H=B([]),V=x(()=>H.value.length>=z.value);function A(){s.warning(`最多允许上传${u.limit}个文件`)}function I(e){const a=parseInt(u.maxSize);if(e.size/1024>a){const e=function(e,a,t=2){const l=["KB","MB","GB","TB","PB","EB","ZB","YB","BB"],n=l.indexOf(a);if(-1===n){const l=Math.max(0,Math.min(t,20));return{value:Number(e.toFixed(l)),unit:a}}let s=e,o=n;const i=Math.max(0,Math.min(t,20));for(;s>=1024&&o<l.length-1;)s/=1024,o++;return{value:Number(s.toFixed(i)),unit:l[o]}}(a,"KB");return s.error(`文件大小不能超过 ${e.value} ${e.unit}`),!1}if(H.value.length>=u.limit)return s.warning(`最多允许上传${u.limit}个文件`),!1;return H.value.some(a=>a.name===e.name&&a.size===e.size&&a.lastModified===e.lastModified)?(s.warning("已选择相同的文件，请重新选择"),!1):(H.value.push(e),!1)}function P(){r("on-cancel"),H.value=[]}function D(){0===H.value.length?s.error("请选择要上传的文件"):(r("on-confirm",H.value),H.value=[])}return c(()=>u.dialogVisible,e=>{C.value=e},{immediate:!0}),(s,i)=>{const u=b("upload-filled"),r=e,c=a,x=n,B=b("CircleClose"),U=t,G=l;return m(),d(G,{modelValue:y(C),"onUpdate:modelValue":i[0]||(i[0]=e=>j(C)?C.value=e:null),title:o.title,width:o.width,modal:o.modal,draggable:o.draggable,"before-close":P},{footer:f(()=>[v("div",O,[p(U,{type:"primary",loading:o.loading,onClick:D},{default:f(()=>[...i[1]||(i[1]=[S("确定",-1)])]),_:1},8,["loading"]),p(U,{onClick:P},{default:f(()=>[...i[2]||(i[2]=[S("取消",-1)])]),_:1})])]),default:f(()=>[p(c,{action:"",multiple:y($),drag:o.drag,accept:o.accept,"on-exceed":A,"before-upload":I,disabled:y(V),limit:y(z)},{default:f(()=>[p(r,{class:"el-icon--upload"},{default:f(()=>[p(u)]),_:1}),v("p",null,_(y(F)),1)]),_:1},8,["multiple","drag","accept","disabled","limit"]),y(H).length>0?(m(),g("ul",N,[(m(!0),g(w,null,k(y(H),e=>(m(),g("li",{key:e.uid,class:"file-box"},[p(x,{effect:"dark",content:e.name,placement:"top"},{content:f(()=>[v("p",E,_(e.name),1)]),default:f(()=>[v("span",M,_(e.name),1)]),_:2},1032,["content"]),p(r,{class:"file-del",size:"18px",onClick:a=>function(e){const a=H.value.findIndex(a=>a.uid===e.uid);-1!==a&&H.value.splice(a,1)}(e)},{default:f(()=>[p(B)]),_:1},8,["onClick"])]))),128))])):h("",!0)]),_:1},8,["modelValue","title","width","modal","draggable"])}}}),[["__scopeId","data-v-fbbbbc06"]]),z={class:"g-container"},F={key:0,class:"tip"},H={key:1,class:"sheet-list"},V=["onClick"],A=C(Object.assign({name:"StudentClassHours"},{__name:"index",setup(e){const a=B(!1),l=B(!1),n=B([]),s=[3,4,5,6,7,8,11,12,13,14,15,16,19,20,21,22,23,24,27,28,29,30,31,32,35,36,37,38,39,40,43,44,45,46,47,48];function c(){a.value=!0}function d(){a.value=!1}async function b(e){l.value=!0;performance.now();var t;n.value=await(t=e[0],new Promise(e=>{const a=new FileReader;a.onload=a=>{const t=a.target.result,l=r(t,{type:"binary"}),n=[];l.SheetNames.forEach(e=>{const a={sheetName:e,sheetData:i.sheet_to_json(l.Sheets[e])};n.push(a)}),e(n)},a.readAsArrayBuffer(t)}));performance.now();l.value=!1,a.value=!1,1===n.value.length&&x(n.value[0])}function x(e){const a=[];e.sheetData.forEach(e=>{if(s.includes(e.__rowNum__))for(const t in e)t.includes("EMPTY")&&a.push(e[t])});const t={};a.forEach((e,l)=>{l%2==0&&(t[e]?t[e].classHours.push(a[l+1]):t[e]={name:e,classHours:[a[l+1]],sum:0})});let l=0;for(const s in t)t[s].classHours.forEach(e=>{t[s].sum+=e}),l+=t[s].sum;const n=Object.values(t).map((e,a)=>{const t={"序号":String(a+1),"姓名":e.name,"总计":e.sum};return e.classHours.forEach((e,a)=>{t[`第${a+1}节`]=e}),t}),o={"序号":"","姓名":"","总计":l};n.push(o),function(e,a){const t=`${a}.xlsx`,l="Sheet 1",n=i.book_new(),s=i.json_to_sheet(e);i.book_append_sheet(n,s,l),u(n,t)}(n,e.sheetName)}return(e,s)=>{const i=t,u=o;return m(),g("div",z,[s[1]||(s[1]=v("h1",null,"课时",-1)),p(u,{class:"card"},{default:f(()=>[p(i,{type:"primary",onClick:c},{default:f(()=>[...s[0]||(s[0]=[S("上传文件",-1)])]),_:1}),y(n).length>1?(m(),g("p",F,"检测到存在多个Sheet页，请选择一个下载")):h("",!0),y(n).length>1?(m(),g("ul",H,[(m(!0),g(w,null,k(y(n),e=>(m(),g("li",{key:e.sheetName,class:"sheet-item",onClick:a=>x(e)},_(e.sheetName),9,V))),128))])):h("",!0)]),_:1}),p($,{"dialog-visible":y(a),accept:".xls,.xlsx",loading:y(l),onOnConfirm:b,onOnCancel:d},null,8,["dialog-visible","loading"])])}}}),[["__scopeId","data-v-d34b11df"]]);export{A as default};

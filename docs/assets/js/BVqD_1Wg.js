import{g as e,c as a,o as t,w as l,a as n,h as s,i as o,j as i,k as u,r as c,t as r,u as d,l as m,m as f,n as p,F as g,p as h,q as v,s as _,v as b,x as y,y as x,A as B,B as w,C as k,D as C,G as S}from"./De2LBf3J.js";const N=(e,a)=>{const t=e.__vccOpts||e;for(const[l,n]of a)t[l]=n;return t},M={key:0,class:"file-list"},j={style:{"max-width":"300px","max-height":"200px","overflow-y":"auto"}},E={class:"file-name g-single-ellipsis"},O={class:"dialog-footer"},z=N(Object.assign({name:"FileUpload"},{__name:"FileUpload",props:{dialogVisible:{type:Boolean,default:!1},width:{type:[String,Number],default:"500"},title:{type:String,default:"上传文件"},modal:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},multiple:{type:Boolean,default:!0},drag:{type:Boolean,default:!0},limit:{type:[Number,String],default:1},accept:{type:[String,Array],default:".xls,.xlsx"},loading:{type:Boolean,default:!1},maxSize:{type:[Number,String],default:5120}},emits:["on-confirm","on-cancel"],setup(w,{emit:k}){const C=w,S=k,N=p(!1),z=m(()=>C.limit>1&&C.multiple),F=m(()=>Number(C.limit)),$=m(()=>C.drag?"将文件拖到此处或点击上传":"点击上传"),H=p([]),V=m(()=>H.value.length>=F.value);function A(){B.warning(`最多允许上传${C.limit}个文件`)}function I(e){const a=parseInt(C.maxSize);if(e.size/1024>a){const e=function(e,a,t=2){const l=["KB","MB","GB","TB","PB","EB","ZB","YB","BB"],n=l.indexOf(a);if(-1===n){const l=Math.max(0,Math.min(t,20));return{value:Number(e.toFixed(l)),unit:a}}let s=e,o=n;const i=Math.max(0,Math.min(t,20));for(;s>=1024&&o<l.length-1;)s/=1024,o++;return{value:Number(s.toFixed(i)),unit:l[o]}}(a,"KB");return B.error(`文件大小不能超过 ${e.value} ${e.unit}`),!1}if(H.value.length>=C.limit)return B.warning(`最多允许上传${C.limit}个文件`),!1;return H.value.some(a=>a.name===e.name&&a.size===e.size&&a.lastModified===e.lastModified)?(B.warning("已选择相同的文件，请重新选择"),!1):(H.value.push(e),!1)}function D(){S("on-cancel"),H.value=[]}function P(){0===H.value.length?B.error("请选择要上传的文件"):(S("on-confirm",H.value),H.value=[])}return e(()=>C.dialogVisible,e=>{N.value=e},{immediate:!0}),(e,m)=>{const p=c("upload-filled"),B=u,k=f,C=x,S=c("CircleClose"),U=_,G=y;return t(),a(G,{modelValue:d(N),"onUpdate:modelValue":m[0]||(m[0]=e=>b(N)?N.value=e:null),title:w.title,width:w.width,modal:w.modal,draggable:w.draggable,"before-close":D},{footer:l(()=>[i("div",O,[n(U,{type:"primary",loading:w.loading,onClick:P},{default:l(()=>[...m[1]||(m[1]=[v("确定",-1)])]),_:1},8,["loading"]),n(U,{onClick:D},{default:l(()=>[...m[2]||(m[2]=[v("取消",-1)])]),_:1})])]),default:l(()=>[n(k,{action:"",multiple:d(z),drag:w.drag,accept:w.accept,"on-exceed":A,"before-upload":I,disabled:d(V),limit:d(F)},{default:l(()=>[n(B,{class:"el-icon--upload"},{default:l(()=>[n(p)]),_:1}),i("p",null,r(d($)),1)]),_:1},8,["multiple","drag","accept","disabled","limit"]),d(H).length>0?(t(),s("ul",M,[(t(!0),s(g,null,h(d(H),e=>(t(),s("li",{key:e.uid,class:"file-box"},[n(C,{effect:"dark",content:e.name,placement:"top"},{content:l(()=>[i("p",j,r(e.name),1)]),default:l(()=>[i("span",E,r(e.name),1)]),_:2},1032,["content"]),n(B,{class:"file-del",size:"18px",onClick:a=>function(e){const a=H.value.findIndex(a=>a.uid===e.uid);-1!==a&&H.value.splice(a,1)}(e)},{default:l(()=>[n(S)]),_:1},8,["onClick"])]))),128))])):o("",!0)]),_:1},8,["modelValue","title","width","modal","draggable"])}}}),[["__scopeId","data-v-fbbbbc06"]]),F={class:"g-container"},$={key:0,class:"tip"},H={key:1,class:"sheet-list"},V=["onClick"],A=N(Object.assign({name:"StudentClassHours"},{__name:"index",setup(e){const a=p(!1),u=p(!1),c=p([]),m=[3,4,5,6,7,8,11,12,13,14,15,16,19,20,21,22,23,24,27,28,29,30,31,32,35,36,37,38,39,40,43,44,45,46,47,48];function f(){a.value=!0}function b(){a.value=!1}async function y(e){u.value=!0;performance.now();var t;c.value=await(t=e[0],new Promise(e=>{const a=new FileReader;a.onload=a=>{const t=a.target.result,l=S(t,{type:"binary"}),n=[];l.SheetNames.forEach(e=>{const a={sheetName:e,sheetData:k.sheet_to_json(l.Sheets[e])};n.push(a)}),e(n)},a.readAsArrayBuffer(t)}));performance.now();u.value=!1,a.value=!1,1===c.value.length&&x(c.value[0])}function x(e){const a=[];e.sheetData.forEach(e=>{if(m.includes(e.__rowNum__))for(const t in e)t.includes("EMPTY")&&a.push(e[t])});const t={};a.forEach((e,l)=>{l%2==0&&(t[e]?t[e].classHours.push(a[l+1]):t[e]={name:e,classHours:[a[l+1]],sum:0})});let l=0;for(const o in t)t[o].classHours.forEach(e=>{t[o].sum+=e}),l+=t[o].sum;const n=Object.values(t).map((e,a)=>{const t={"序号":String(a+1),"姓名":e.name,"总计":e.sum};return e.classHours.forEach((e,a)=>{t[`第${a+1}节`]=e}),t}),s={"序号":"","姓名":"","总计":l};n.push(s),function(e,a){const t=`${a}.xlsx`,l="Sheet 1",n=k.book_new(),s=k.json_to_sheet(e);k.book_append_sheet(n,s,l),C(n,t)}(n,e.sheetName)}return(e,m)=>{const p=_,B=w;return t(),s("div",F,[m[1]||(m[1]=i("h1",null,"课时",-1)),n(B,{class:"card"},{default:l(()=>[n(p,{type:"primary",onClick:f},{default:l(()=>[...m[0]||(m[0]=[v("上传文件",-1)])]),_:1}),d(c).length>1?(t(),s("p",$,"检测到存在多个Sheet页，请选择一个下载")):o("",!0),d(c).length>1?(t(),s("ul",H,[(t(!0),s(g,null,h(d(c),e=>(t(),s("li",{key:e.sheetName,class:"sheet-item",onClick:a=>x(e)},r(e.sheetName),9,V))),128))])):o("",!0)]),_:1}),n(z,{"dialog-visible":d(a),accept:".xls,.xlsx",loading:d(u),onOnConfirm:y,onOnCancel:b},null,8,["dialog-visible","loading"])])}}}),[["__scopeId","data-v-44067a2f"]]);export{A as default};

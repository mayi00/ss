import{a as e,b as a,c as t,d as l,e as n,f as s,g as o}from"./CY3vN8sq-1765510165412.js";import{u as i,w as u,r}from"./DSA9T5jJ-1765510165412.js";import{b as c,j as d,i as m,K as f,o as p,M as g,J as h,c as v,L as b,a as _,a8 as y,V as x,u as B,I as w,a0 as k,W as j,m as S}from"./DxF57nBF-1765510165412.js";import"./eZ8nN_Qw-1765510165412.js";import"./CT_jBSb5-1765510165412.js";import"./CG_8-mBG-1765510165412.js";import"./n22iUiFn-1765510165412.js";import"./D2oWfImC-1765510165412.js";const C=(e,a)=>{const t=e.__vccOpts||e;for(const[l,n]of a)t[l]=n;return t},N={key:0,class:"file-list"},M={style:{"max-width":"300px","max-height":"200px","overflow-y":"auto"}},E={class:"file-name g-single-ellipsis"},O={class:"dialog-footer"},z=C(Object.assign({name:"FileUpload"},{__name:"FileUpload",props:{dialogVisible:{type:Boolean,default:!1},width:{type:[String,Number],default:"500"},title:{type:String,default:"上传文件"},modal:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},multiple:{type:Boolean,default:!0},drag:{type:Boolean,default:!0},limit:{type:[Number,String],default:1},accept:{type:[String,Array],default:".xls,.xlsx"},loading:{type:Boolean,default:!1},maxSize:{type:[Number,String],default:5120}},emits:["on-confirm","on-cancel"],setup(o,{emit:i}){const u=o,r=i,C=c(!1),z=d(()=>u.limit>1&&u.multiple),V=d(()=>Number(u.limit)),$=d(()=>u.drag?"将文件拖到此处或点击上传":"点击上传"),F=c([]),H=d(()=>F.value.length>=V.value);function I(){s.warning(`最多允许上传${u.limit}个文件`)}function A(e){const a=parseInt(u.maxSize);if(e.size/1024>a){const e=function(e,a,t=2){const l=["KB","MB","GB","TB","PB","EB","ZB","YB","BB"],n=l.indexOf(a);if(-1===n){const l=Math.max(0,Math.min(t,20));return{value:Number(e.toFixed(l)),unit:a}}let s=e,o=n;const i=Math.max(0,Math.min(t,20));for(;s>=1024&&o<l.length-1;)s/=1024,o++;return{value:Number(s.toFixed(i)),unit:l[o]}}(a,"KB");return s.error(`文件大小不能超过 ${e.value} ${e.unit}`),!1}if(F.value.length>=u.limit)return s.warning(`最多允许上传${u.limit}个文件`),!1;return F.value.some(a=>a.name===e.name&&a.size===e.size&&a.lastModified===e.lastModified)?(s.warning("已选择相同的文件，请重新选择"),!1):(F.value.push(e),!1)}function K(){r("on-cancel"),F.value=[]}function P(){0===F.value.length?s.error("请选择要上传的文件"):(r("on-confirm",F.value),F.value=[])}return m(()=>u.dialogVisible,e=>{C.value=e},{immediate:!0}),(s,i)=>{const u=y("upload-filled"),r=e,c=a,d=n,m=y("CircleClose"),U=t,D=l;return p(),f(D,{modelValue:B(C),"onUpdate:modelValue":i[0]||(i[0]=e=>S(C)?C.value=e:null),title:o.title,width:o.width,modal:o.modal,draggable:o.draggable,"before-close":K},{footer:g(()=>[_("div",O,[h(U,{type:"primary",loading:o.loading,onClick:P},{default:g(()=>[...i[1]||(i[1]=[j("确定",-1)])]),_:1},8,["loading"]),h(U,{onClick:K},{default:g(()=>[...i[2]||(i[2]=[j("取消",-1)])]),_:1})])]),default:g(()=>[h(c,{action:"",multiple:B(z),drag:o.drag,accept:o.accept,"on-exceed":I,"before-upload":A,disabled:B(H),limit:B(V)},{default:g(()=>[h(r,{class:"el-icon--upload"},{default:g(()=>[h(u)]),_:1}),_("p",null,x(B($)),1)]),_:1},8,["multiple","drag","accept","disabled","limit"]),B(F).length>0?(p(),v("ul",N,[(p(!0),v(w,null,k(B(F),e=>(p(),v("li",{key:e.uid,class:"file-box"},[h(d,{effect:"dark",content:e.name,placement:"top"},{content:g(()=>[_("p",M,x(e.name),1)]),default:g(()=>[_("span",E,x(e.name),1)]),_:2},1032,["content"]),h(r,{class:"file-del",size:"18px",onClick:a=>function(e){const a=F.value.findIndex(a=>a.uid===e.uid);-1!==a&&F.value.splice(a,1)}(e)},{default:g(()=>[h(m)]),_:1},8,["onClick"])]))),128))])):b("",!0)]),_:1},8,["modelValue","title","width","modal","draggable"])}}}),[["__scopeId","data-v-fbbbbc06"]]),V={class:"g-container"},$={key:0,class:"tip"},F={key:1,class:"sheet-list"},H=["onClick"],I=C(Object.assign({name:"StudentClassHours"},{__name:"index",setup(e){const a=c(!1),l=c(!1),n=c([]),s=[3,4,5,6,7,8,11,12,13,14,15,16,19,20,21,22,23,24,27,28,29,30,31,32,35,36,37,38,39,40,43,44,45,46,47,48];function d(){a.value=!0}function m(){a.value=!1}async function f(e){l.value=!0;performance.now();var t;n.value=await(t=e[0],new Promise(e=>{const a=new FileReader;a.onload=a=>{const t=a.target.result,l=r(t,{type:"binary"}),n=[];l.SheetNames.forEach(e=>{const a={sheetName:e,sheetData:i.sheet_to_json(l.Sheets[e])};n.push(a)}),e(n)},a.readAsArrayBuffer(t)}));performance.now();l.value=!1,a.value=!1,1===n.value.length&&y(n.value[0])}function y(e){const a=[];e.sheetData.forEach(e=>{if(s.includes(e.__rowNum__))for(const t in e)t.includes("EMPTY")&&a.push(e[t])});const t={};a.forEach((e,l)=>{l%2==0&&(t[e]?t[e].classHours.push(a[l+1]):t[e]={name:e,classHours:[a[l+1]],sum:0})});let l=0;for(const s in t)t[s].classHours.forEach(e=>{t[s].sum+=e}),l+=t[s].sum;const n=Object.values(t).map((e,a)=>{const t={"序号":String(a+1),"姓名":e.name,"总计":e.sum};return e.classHours.forEach((e,a)=>{t[`第${a+1}节`]=e}),t}),o={"序号":"","姓名":"","总计":l};n.push(o),function(e,a){const t=`${a}.xlsx`,l="Sheet 1",n=i.book_new(),s=i.json_to_sheet(e);i.book_append_sheet(n,s,l),u(n,t)}(n,e.sheetName)}return(e,s)=>{const i=t,u=o;return p(),v("div",V,[s[1]||(s[1]=_("h1",null,"学生课时",-1)),h(u,{class:"card"},{default:g(()=>[h(i,{type:"primary",onClick:d},{default:g(()=>[...s[0]||(s[0]=[j("上传文件",-1)])]),_:1}),B(n).length>1?(p(),v("p",$,"检测到存在多个Sheet页，请选择一个下载")):b("",!0),B(n).length>1?(p(),v("ul",F,[(p(!0),v(w,null,k(B(n),e=>(p(),v("li",{key:e.sheetName,class:"sheet-item",onClick:a=>y(e)},x(e.sheetName),9,H))),128))])):b("",!0)]),_:1}),h(z,{"dialog-visible":B(a),accept:".xls,.xlsx",loading:B(l),onOnConfirm:f,onOnCancel:m},null,8,["dialog-visible","loading"])])}}}),[["__scopeId","data-v-7a060bd0"]]);export{I as default};
